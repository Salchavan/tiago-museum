import"./tailwindcss-CRRPhJTw.js";import"./news-slider-CJ82AR21.js";const x=()=>{const t=document.getElementById("open-add-restoration-modal"),e=document.getElementById("add-restoration-modal"),n=e?.querySelector("[data-modal-close]");if(!t||!e)return;const s=e.querySelector("#add-restoration-status"),a=(r,d)=>{s&&(s.textContent=r,s.classList.remove("text-red-600","text-green-700","text-gray-600"),d==="success"?s.classList.add("text-green-700"):d==="info"?s.classList.add("text-gray-600"):s.classList.add("text-red-600"))},o=r=>{r?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),a("","info")):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};t.addEventListener("click",()=>o(!0)),n?.addEventListener("click",()=>o(!1)),e.addEventListener("click",r=>{r.target===e&&o(!1)}),document.addEventListener("keydown",r=>{r.key==="Escape"&&!e.classList.contains("hidden")&&o(!1)});const i=e.querySelector("#add-restoration-form");i?.addEventListener("submit",async r=>{r.preventDefault();const d=i.querySelector('button[type="submit"]'),c=new FormData(i),u=String(c.get("title")??"").trim(),g=String(c.get("description")??"").trim(),f=String(c.get("image")??"").trim(),p=String(c.get("date_started")??"").trim();if(!u||!g||!f||!p){a("Completa todos los campos.","error");return}const y=B(p);try{d&&(d.disabled=!0,d.classList.add("opacity-60")),a("Guardando...","info");const l=await fetch("/api/restorations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:u,description:g,image:f,date_started:y})}),m=await l.json().catch(()=>null);if(!l.ok||!m?.success){a(m?.message||"No se pudo guardar la restauración.","error");return}a("Restauración guardada.","success"),i.reset(),o(!1),window.location.reload()}catch(l){console.error("Error al guardar la restauración:",l),a("No se pudo conectar al servidor. Ejecuta el proyecto con `npm run dev`.","error")}finally{d&&(d.disabled=!1,d.classList.remove("opacity-60"))}})};function B(t){const e=/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/.exec(t);if(!e)return t;const[,n,s,a]=e;return`${s}/${a}/${n}`}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x):x();const D=()=>{const t=document.getElementById("open-add-news-modal"),e=document.getElementById("add-news-modal"),n=e?.querySelector("[data-modal-close]");if(!t||!e)return;const s=e.querySelector("#add-news-status"),a=(r,d)=>{s&&(s.textContent=r,s.classList.remove("text-red-600","text-green-700","text-gray-600"),d==="success"?s.classList.add("text-green-700"):d==="info"?s.classList.add("text-gray-600"):s.classList.add("text-red-600"))},o=r=>{r?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),a("","info")):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};t.addEventListener("click",()=>o(!0)),n?.addEventListener("click",()=>o(!1)),e.addEventListener("click",r=>{r.target===e&&o(!1)}),document.addEventListener("keydown",r=>{r.key==="Escape"&&!e.classList.contains("hidden")&&o(!1)});const i=e.querySelector("#add-news-form");i?.addEventListener("submit",async r=>{r.preventDefault();const d=i.querySelector('button[type="submit"]'),c=new FormData(i),u=String(c.get("type")??"").trim(),g=String(c.get("title")??"").trim(),f=String(c.get("description")??"").trim(),p=String(c.get("image")??"").trim(),y=String(c.get("link")??"").trim(),l=String(c.get("date")??"").trim();if(!u||!g||!f||!p||!y||!l){a("Completa todos los campos.","error");return}const m=I(l);try{d&&(d.disabled=!0,d.classList.add("opacity-60")),a("Guardando...","info");const v=await fetch("/api/news",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:m,type:u,title:g,description:f,image:p,link:y})}),b=await v.json().catch(()=>null);if(!v.ok||!b?.success){a(b?.message||"No se pudo guardar la noticia.","error");return}a("Noticia guardada.","success"),i.reset(),o(!1),window.location.reload()}catch(v){console.error("Error al guardar la noticia:",v),a("No se pudo conectar al servidor. Ejecuta el proyecto con `npm run dev`.","error")}finally{d&&(d.disabled=!1,d.classList.remove("opacity-60"))}})};function I(t){const e=/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/.exec(t);if(!e)return t;const[,n,s,a]=e;return`${s}/${a}/${n}`}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D();const E=()=>{const t=document.getElementById("open-calendar-reservations-modal"),e=document.getElementById("calendar-reservations-modal"),n=e?.querySelector("[data-modal-close]");if(!t||!e)return;const s=e.querySelector("#calendar-title"),a=e.querySelector("#calendar-grid");if(!a)return;const o=i=>{i?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),q(new Date,A(),s,a)):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};t.addEventListener("click",()=>o(!0)),n?.addEventListener("click",()=>o(!1)),e.addEventListener("click",i=>{i.target===e&&o(!1)}),document.addEventListener("keydown",i=>{i.key==="Escape"&&!e.classList.contains("hidden")&&o(!1)})};function q(t,e,n,s){const a=t.getFullYear(),o=t.getMonth(),i=new Intl.DateTimeFormat("es-AR",{month:"long",year:"numeric"}).format(new Date(a,o,1));n&&(n.textContent=F(i));const r=new Date(a,o,1),c=new Date(a,o+1,0).getDate(),u=(r.getDay()+6)%7,g=Math.ceil((u+c)/7)*7,f=j(e),p=["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"];s.innerHTML=`
    <div class="grid grid-cols-7 bg-gray-50 border-b border-gray-200">
      ${p.map(y=>`<div class="px-3 py-2 text-xs font-semibold text-gray-600 uppercase tracking-wide">${y}</div>`).join("")}
    </div>
    <div class="grid grid-cols-7">
      ${Array.from({length:g}).map((y,l)=>{const m=l-u+1;if(!(m>=1&&m<=c))return'<div class="h-20 md:h-24 border-b border-gray-100 border-r border-gray-100 bg-white"></div>';const b=M(a,o,m),h=f.get(b)??[],L=h.slice(0,2),w=h.length-L.length,$=L.map(S=>`
                <div class="mt-1 text-[11px] leading-tight bg-black text-white rounded-md px-2 py-1">
                  <span class="font-semibold">${k(S.time)}</span>
                  <span class="opacity-90"> ${k(S.name)}</span>
                </div>
              `).join(""),C=w>0?`<div class="mt-1 text-[11px] text-gray-600">+${w} más</div>`:"";return`
            <div class="h-20 md:h-24 border-b border-gray-100 border-r border-gray-100 p-2 bg-white">
              <div class="flex items-center justify-between">
                <span class="text-sm font-semibold text-gray-800">${m}</span>
                ${h.length?'<span class="text-[10px] font-semibold text-gray-500">reservas</span>':""}
              </div>
              <div class="mt-1">${$}${C}</div>
            </div>
          `}).join("")}
    </div>
  `}function A(){const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=(s,a,o,i)=>{const r=new Date(e);return r.setDate(e.getDate()+s),{date:M(r.getFullYear(),r.getMonth(),r.getDate()),time:a,name:o,cuantity:i}};return[n(1,"10:00","Familia García",4),n(1,"12:30","Colegio San Martín",18),n(3,"11:00","Ana López",2),n(6,"09:30","Grupo Turismo Córdoba",12),n(9,"16:00","Martín Pérez",3),n(12,"14:30","Visita guiada (Prueba)",10)]}function j(t){const e=new Map;for(const n of t){const s=e.get(n.date);s?s.push(n):e.set(n.date,[n])}for(const[n,s]of e)s.sort((a,o)=>a.time.localeCompare(o.time)),e.set(n,s);return e}function M(t,e,n){const s=String(t),a=String(e+1).padStart(2,"0"),o=String(n).padStart(2,"0");return`${s}-${a}-${o}`}function F(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}function k(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E();
