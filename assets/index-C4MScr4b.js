(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function s(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=s(t);fetch(t.href,a)}})();document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("backToTop");document.addEventListener("keydown",s=>{s.ctrlKey&&s.key.toLowerCase()==="k"&&(s.preventDefault(),window.location.href="./login.html")}),n&&(window.addEventListener("scroll",()=>{window.pageYOffset>300?n.classList.remove("hidden"):n.classList.add("hidden")}),n.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})),document.querySelectorAll('a[href^="#"]').forEach(s=>{s.addEventListener("click",o=>{o.preventDefault();const t=s.getAttribute("href");if(!t||t==="#")return;const a=document.querySelector(t);a&&window.scrollTo({top:a.offsetTop-80,behavior:"smooth"})})}),document.querySelector("button.md\\:hidden")?.addEventListener("click",()=>{alert("Mobile menu would open here. In a real implementation, this would show/hide a menu.")})});const m=()=>{const n=document.getElementById("open-reservation-modal"),e=document.getElementById("reservation-modal"),s=e?.querySelector("[data-modal-close]");if(!n||!e)return;const o=t=>{t?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden")):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};n.addEventListener("click",()=>o(!0)),s?.addEventListener("click",()=>o(!1)),e.addEventListener("click",t=>{t.target===e&&o(!1)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&!e.classList.contains("hidden")&&o(!1)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m();const f=()=>{const n=document.getElementById("open-restorations-modal"),e=document.getElementById("restorations-modal"),s=e?.querySelector("[data-modal-close]");if(!n||!e)return;const o=t=>{t?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden")):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};n.addEventListener("click",()=>o(!0)),s?.addEventListener("click",()=>o(!1)),e.addEventListener("click",t=>{t.target===e&&o(!1)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&!e.classList.contains("hidden")&&o(!1)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f();const p=()=>{const n=document.getElementById("open-news-modal"),e=document.getElementById("news-modal"),s=e?.querySelector("[data-modal-close]"),o=e?.querySelector("#news-modal-list");if(!n||!e)return;const t=a=>{a?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden")):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};n.addEventListener("click",()=>t(!0)),s?.addEventListener("click",()=>t(!1)),e.addEventListener("click",a=>{a.target===e&&t(!1)}),document.addEventListener("keydown",a=>{a.key==="Escape"&&!e.classList.contains("hidden")&&t(!1)}),o&&E(o)},E=async n=>{n.innerHTML=`
    <div class="text-gray-500 text-sm col-span-full">
      Cargando noticias...
    </div>
  `;try{const e=await fetch("./src/data/n.json");if(!e.ok)throw new Error("No se pudo obtener la lista de noticias");const s=await e.json();if(!s.length){n.innerHTML=`
        <div class="text-gray-500 text-sm col-span-full text-center py-8">
          No hay noticias disponibles en este momento.
        </div>
      `;return}const o=document.createDocumentFragment();s.forEach(t=>{o.appendChild(b(t))}),n.innerHTML="",n.appendChild(o)}catch(e){console.error("Error al cargar las noticias:",e),n.innerHTML=`
      <div class="text-red-600 text-sm col-span-full text-center py-8">
        No se pudieron cargar las noticias. Inténtalo nuevamente más tarde.
      </div>
    `}},b=n=>{const e=document.createElement("article");e.className="bg-gray-50 border border-gray-100 rounded-2xl p-4 flex flex-col gap-3";const s=new Date(n.date),o=isNaN(s.getTime())?n.date:s.toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"});e.innerHTML=`
    <div class="flex items-center justify-between text-xs uppercase tracking-wide text-gray-500">
      <span class="font-semibold text-black/70">${n.type}</span>
      <span>${o}</span>
    </div>
    <h4 class="text-lg font-semibold leading-snug">${n.title}</h4>
    <p class="text-sm text-gray-600 flex-1">${n.description}</p>
    <a class="text-sm font-semibold gold-text hover:underline inline-flex items-center gap-2 mt-auto">
      <span>Ver detalle</span>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-6-6 6 6-6 6" />
      </svg>
    </a>
  `;const t=e.querySelector("a");return t&&(t.setAttribute("href",n.link||"#"),t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer")),e};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p();const y=()=>{const n=document.getElementById("open-donation-modal"),e=document.getElementById("donation-modal"),s=e?.querySelector("[data-modal-close]");if(!n||!e)return;const o=t=>{t?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden")):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};n.addEventListener("click",()=>o(!0)),s?.addEventListener("click",()=>o(!1)),e.addEventListener("click",t=>{t.target===e&&o(!1)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&!e.classList.contains("hidden")&&o(!1)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y();const g=()=>{const n=document.getElementById("open-comment-modal"),e=document.getElementById("comment-modal"),s=e?.querySelector("[data-modal-close]");if(!n||!e)return;const o=a=>{a?(e.classList.remove("hidden"),document.body.classList.add("overflow-hidden")):(e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};n.addEventListener("click",()=>o(!0)),s?.addEventListener("click",()=>o(!1)),e.addEventListener("click",a=>{a.target===e&&o(!1)}),document.addEventListener("keydown",a=>{a.key==="Escape"&&!e.classList.contains("hidden")&&o(!1)});const t=e.querySelector("#comment-form");t?.addEventListener("submit",a=>{a.preventDefault(),t.reset(),o(!1)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g();const v=()=>{const n=document.getElementById("comments-cards");n&&x(n)},x=async n=>{n.innerHTML=`
    <div class="text-gray-500 text-sm col-span-full">
      Cargando comentarios...
    </div>
  `;try{const e=await fetch("./src/data/c.json");if(!e.ok)throw new Error("No se pudo obtener la lista de comentarios");const s=await e.json();if(!Array.isArray(s)||s.length===0){n.innerHTML=`
        <div class="text-gray-500 text-sm col-span-full text-center py-8">
          No hay comentarios disponibles en este momento.
        </div>
      `;return}const o=[...s].sort((a,r)=>{const d=h(a.date)?.getTime()??-1/0;return(h(r.date)?.getTime()??-1/0)-d});n.innerHTML="";const t=document.createDocumentFragment();for(const a of o)t.appendChild(k(a));n.appendChild(t)}catch(e){console.error("Error al cargar comentarios de la sección:",e),n.innerHTML=`
      <div class="text-red-600 text-sm col-span-full text-center py-8">
        No se pudieron cargar los comentarios.
      </div>
    `}},k=n=>{const e=document.createElement("article");e.className="bg-white rounded-lg overflow-hidden shadow-lg news-card";const s=document.createElement("div");s.className="p-6";const o=document.createElement("div");o.className="flex flex-row items-center gap-4 mb-4";const t=document.createElement("img");t.src=n.perfilicon,t.alt=`Foto de ${n.username}`,t.className="h-16 w-16 rounded-full object-cover";const a=document.createElement("div"),r=document.createElement("h3");r.className="text-xl font-bold",r.textContent=n.username;const d=document.createElement("span");d.className="text-gray-500 text-sm",d.textContent=n.date,a.appendChild(r),a.appendChild(d),o.appendChild(t),o.appendChild(a);const c=document.createElement("p");return c.className="text-gray-700",c.textContent=n.text,s.appendChild(o),s.appendChild(c),e.appendChild(s),e};function h(n){const e=/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/.exec(n.trim());if(!e){const l=new Date(n);return isNaN(l.getTime())?null:l}const[,s,o,t]=e,a=Number(s),r=Number(o),d=Number(t);if(!Number.isFinite(a)||!Number.isFinite(r)||!Number.isFinite(d))return null;const c=new Date(d,a-1,r);return isNaN(c.getTime())?null:c}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();let u=null;const w=()=>{const n=document.getElementById("reservation-form"),e=document.getElementById("reservation-status");!n||!e||n.addEventListener("submit",async s=>{s.preventDefault();const o=N(new FormData(n));if(!o){i(e,"Completa todos los campos obligatorios.","error");return}i(e,"Enviando reserva...","info");try{const t=await C(o);n.reset(),t==="download"?i(e,"Reserva guardada. Se descargó a.json actualizado (reemplaza src/data/a.json).","success"):t==="api"?i(e,"Reserva guardada en src/data/a.json.","success"):i(e,"Reserva enviada correctamente. Te contactaremos a la brevedad.","success")}catch(t){console.error("Error al enviar la reserva:",t),i(e,"No se pudo guardar la reserva. Intenta nuevamente más tarde.","error")}})},N=n=>{const e=l=>String(n.get(l)??"").trim(),s=e("date"),o=e("time"),t=e("dni"),a=e("name"),r=e("tel"),d=e("mail"),c=Number(n.get("cuantity"));return!s||!o||!t||!a||!r||!d||!Number.isFinite(c)||c<=0?null:{date:s,time:o,dni:t,name:a,tel:r,mail:d,cuantity:c}},i=(n,e,s)=>{const o={info:"text-gray-600",success:"text-green-600",error:"text-red-600"};n.textContent=e,n.classList.remove("text-gray-600","text-green-600","text-red-600"),n.classList.add(o[s])};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w();const C=async n=>{try{return await S(n),"api"}catch{}if(window.showOpenFilePicker){const s=await M(),o=await T(s),t={id:L(o),...n};return o.push(t),await D(s,o),"file"}return await B(n),"download"},S=async n=>{const e=await fetch("/api/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),s=await e.json().catch(()=>null);if(!e.ok||!s?.success)throw new Error(s?.message||"No se pudo guardar la reserva")},M=async()=>{if(u)return u;const n=window.showOpenFilePicker;if(!n)throw new Error("No disponible showOpenFilePicker");const[e]=await n({multiple:!1,types:[{description:"Archivo JSON",accept:{"application/json":[".json"]}}]});if(!e)throw new Error("No se seleccionó ningún archivo");return u=e,e},B=async n=>{const e=await O(),s={id:L(e),...n},o=[...e,s];localStorage.setItem("tiago-museum:reservations",JSON.stringify(o)),I("a.json",o)},O=async()=>{const n=localStorage.getItem("tiago-museum:reservations");if(n)try{const e=JSON.parse(n);if(Array.isArray(e))return e}catch{}try{const e=await fetch("/src/data/a.json",{cache:"no-store"});if(!e.ok)return[];const s=await e.json();return Array.isArray(s)?s:[]}catch{return[]}},I=(n,e)=>{const s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(s),t=document.createElement("a");t.href=o,t.download=n,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(o)},T=async n=>{const s=await(await n.getFile()).text();if(!s.trim())return[];const o=JSON.parse(s);return Array.isArray(o)?o.filter(t=>!t||typeof t!="object"?!1:typeof t.id=="string"):[]},D=async(n,e)=>{const s=await n.createWritable();await s.write(JSON.stringify(e,null,2)),await s.close()},L=n=>{const e=n.reduce((s,o)=>{const t=Number(o.id);return Number.isFinite(t)&&t>s?t:s},0);return String(e+1)};
